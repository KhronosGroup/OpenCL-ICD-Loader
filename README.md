# Getting the ICD Loader

<table>
    <tr><th>Conan</th><th>vcpkg</th><th>CMake (v3.0 and up)</th></tr>
    <tr>
        <td><a href="https://bintray.com/bincrafters/public-conan/khronos-opencl-icd-loader%3Abincrafters/_latestVersion"><img src="https://api.bintray.com/packages/bincrafters/public-conan/khronos-opencl-icd-loader%3Abincrafters/images/download.svg"></img></a></td>
        <td><a href="https://github.com/microsoft/vcpkg/tree/master/ports/opencl"><img src="https://img.shields.io/badge/vcpkg-opencl-blueviolet.svg"></img></a></td>
        <td>
<pre language="cmake"><code>
find_package(OpenCL REQUIRED NO_MODULE)
target_link_libraries(app PRIVATE OpenCL::OpenCL)
</code></pre>
        </td>
        </tr>
</table>

Please note that these packages are maintained by the community and not by the Khronos Group. Please raise any packaging-related issues on their respective repositories.

# Building the OpenCL ICD Loader and Tests

The build system will build ICD Loader library (OpenCL.dll or libOpenCL.so), the
ICD Loader Test binary (icd_loader_test), and some helper libraries for the test.

## Linux

Run "make"

## Windows

Run "build_using_cmake.bat"

## Running ICD Test

The ICD Test can be run using ctest, which is a companion to cmake. It can also be
run directly by executing icd_loader_test(.exe) executable from the bin folder.

### Linux

1. Add driver stub as an ICD
    echo full/path/to/libOpenCLDriverStub.so > /etc/OpenCL/vendors/test.icd

2. Run test using ctest
    make test

### Windows

1. Add driver stub as an ICD by adding appropriate registry value
    Key for 32-bit apps: HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Khronos\OpenCL\Vendors
    Key for 64-bit apps: HKEY_LOCAL_MACHINE\SOFTWARE\Khronos\OpenCL\Vendors

    Add a REG_DWORD value:
        Name: c:/full/path/to/OpenCLDriverStub.dll
        Data: 0

    Note: The build_using_cmake.bat builds ICD test as a 32-bit binary.
    
2. Run test using ctest.exe
    cd build
    ctest.exe

### Cleanup

Manually remove the registry key or .icd files added for running the ICD test.

The "build" and "bin" folders are autogenerated by the build so those may be
safely deleted without losing any source code (on Linux "make clobber" will
delete them).
